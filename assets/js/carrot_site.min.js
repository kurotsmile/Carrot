class Carrot_Site{firebaseConfig_mainhost;count_act_dev=0;mode_site="nomal";is_dev=!1;is_localhost=!1;paypal_CLIENT_ID="";index_server=0;lang;langs;lang_url="";recognition=null;style_mode="sun";obj_version_new=null;obj_version_cur=null;name_collection_cur="";name_document_cur="";id_page;body;load_bar_count_data=0;db;auth;firebase;storage;user;menu;avatar;file;pay;rate;config;server;os;type_server="firestore";v="0.0.3";constructor(){null!=localStorage.getItem("index_server")&&(this.index_server=parseInt(localStorage.getItem("index_server"))),fetch("rabbit.data?v="+this.v).then(e=>e.text()).then(e=>{var t=atob(e);this.config=JSON.parse(t),this.setup_server_os()})}setup_server_os(){var e=navigator.userAgent,t="Unknown OS";-1!==e.indexOf("Win")?t="Windows":-1!==e.indexOf("like Mac")?t="iOS":-1!==e.indexOf("Mac")?t="MacOS":-1!==e.indexOf("X11")?t="UNIX":-1!==e.indexOf("Linux")?t="Linux":-1!==e.indexOf("Android")&&(t="Android"),this.os=t,"MacOS"==t||"iOS"==t?(this.type_server="json",$.getJSON(this.config.list_url_data_setting_web[0],e=>{var t=e.all_item;carrot.obj_version_new=t[1],carrot.load_page(t[1])})):this.setup_sever_db(this.index_server)}setup_sever_db(e){this.firebaseConfig_mainhost=this.config.server[e],this.log("setup_sever_db","warning"),null==localStorage.getItem("is_localhost")?this.is_localhost=!1:"false"==localStorage.getItem("is_localhost")?this.is_localhost=!1:this.is_localhost=!0,this.firebase=firebase.initializeApp(this.firebaseConfig_mainhost),this.auth=this.firebase.auth(),this.storage=this.firebase.storage(),this.db=this.firebase.firestore(),this.is_localhost&&(this.auth.useEmulator("http://localhost:9099",{disableWarnings:!0}),this.db.useEmulator("localhost",8082),this.storage.useEmulator("localhost",9199)),null!=localStorage.getItem("mode_site")&&(this.mode_site=localStorage.getItem("mode_site")),null!=localStorage.getItem("is_dev")&&(this.is_dev=localStorage.getItem("is_dev")),this.load_obj_version_new(),this.load_obj_version_cur(),this.check_version_data()}set_doc(e,t,s){this.log("Set "+e+"."+t+" from server","warning"),this.db.collection(e).doc(t).set(s)}set_doc_merge(s_collection,s_document,data,act_done=null){this.log("Set "+s_collection+"."+s_document+" from server","warning"),this.db.collection(s_collection).doc(s_document).set(data,{merge:!0}).then(()=>{null!=act_done&&eval(act_done)(carrot)})}update_doc(e,t,s){return this.log("Update "+e+"."+t+" from server","warning"),this.db.collection(e).doc(t).update(s).then(()=>{console.log("Document successfully updated!")}).catch(e=>{console.error("Error updating document: ",e)})}edit_doc(e,t,s){this.update_doc(e,t,s)}get_doc(e,t,s){Swal.showLoading(),this.log("Get "+e+"."+t+" from server","warning"),this.db.collection(e).doc(t).get().then(e=>{if(e.exists){var t=e.data();t.id=e.id,Swal.close(),s(t,this)}else console.log("No such document!"),Swal.close(),s(null,this)}).catch(e=>{console.log(e),Swal.close(),this.log_error(e),s(null,this)})}get_list_doc(e,t){this.log("Get List "+e+" from server","warning"),this.db.collection(e).get().then(e=>{var s={};e.forEach(e=>{var t=e.data();t.id=e.id,s[e.id]=JSON.stringify(t)}),t(s,this)}).catch(e=>{this.log_error(e),t(null,this)})}check_version_data(){this.log("Load js version:"+this.get_ver_cur("js"),"null"),$("head").append('<script type="text/javascript" src="assets/js/carrot_server.js?ver='+this.get_ver_cur("js")+'"></script>'),this.server=new Carrot_Server,carrot.load_bar(),carrot.server.get_doc("setting_web","version",e=>{carrot.load_page(e)},()=>{})}load_page(e){if(carrot.obj_version_new=e,carrot.save_obj_version_new(),carrot.save_obj_version_cur(),carrot.load_bar(),this.update_new_ver_cur("js",!0),this.update_new_ver_cur("page",!0),this.body=$("#main_contain"),this.is_dev?this.paypal_CLIENT_ID=carrot.config.paypal_dev_CLIENT_ID:this.paypal_CLIENT_ID=carrot.config.paypal_pub_CLIENT_ID,$("head").append('<script type="text/javascript" src="assets/js/carrot_data.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_langs.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_form.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_user.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_rate.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_menu.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_list_item.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_pay.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_player_media.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_file.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_about_us.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="assets/js/carrot_privacy_policy.js?ver='+this.get_ver_cur("js")+'"></script>'),$("head").append('<script type="text/javascript" src="https://www.paypal.com/sdk/js?client-id='+this.paypal_CLIENT_ID+'"></script>'),this.menu=new Carrot_Menu(this),this.langs=new Carrot_Langs(this),$(this.menu.create("btn_home_new").set_label("Home new").set_lang("home").set_icon("fa-solid fa-home")).click(function(){carrot.home_page()}),$(this.menu.create("btn_app").set_label("App and Game").set_lang("app").set_icon("fa-solid fa-gamepad")).click(function(){carrot.load_js_page("app","appp","carrot.appp.back_show_all()")}),$(carrot.menu.create("app").set_label("Add App").set_icon("fa-solid fa-mobile").set_type("add")).click(function(){carrot.load_js_page("app","appp","carrot.appp.add()")}),$(carrot.menu.create("app").set_label("Add Link Store").set_icon("fa-solid fa-store").set_type("add")).click(function(){carrot.load_js_page("app","app","carrot.appp.add_link_store()")}),$(carrot.menu.create("app").set_label("List Store").set_icon("fa-solid fa-store").set_type("dev")).click(function(){carrot.load_js_page("app","app","carrot.appp.show_other_store()")}),this.user=new Carrot_user,this.phone_book=this.user,$(this.menu.create("btn_list_music").set_label("Music").set_lang("music").set_icon("fa-solid fa-music")).click(function(){carrot.load_js_page("song","song","carrot.song.list()")}),$(this.menu.create("btn_code").set_label("Coder").set_lang("code").set_icon("fa-solid fa-code")).click(function(){carrot.load_js_page("code","coder","carrot.coder.list()")}),$(this.menu.create("btn_midi_piano").set_label("Midi").set_lang("midi").set_icon("fa-solid fa-drum")).click(function(){carrot.load_js_page("piano","midi","carrot.midi.show_list()")}),$(this.menu.create("btn_ico").set_label("Icon").set_type("main").set_lang("icon").set_icon("fa-solid fa-face-smile")).click(function(){carrot.load_js_page("ico","ico","carrot.ico.list()")}),$(this.menu.create("btn_football").set_label("Football").set_type("main").set_lang("football").set_icon("fa-solid fa-futbol")).click(function(){carrot.load_js_page("football","football","carrot.football.list()")}),$(this.menu.create("btn_audio").set_label("Audio").set_type("main").set_lang("audio").set_icon("fa-solid fa-guitar")).click(function(){carrot.load_js_page("audio","audio","carrot.audio.show()")}),$(this.menu.create("btn_radio").set_label("Radio").set_type("main").set_lang("radio").set_icon("fa-solid fa-radio")).click(function(){carrot.load_js_page("radio","radio","carrot.radio.list()")}),$(this.menu.create("btn_bk").set_label("List Background").set_lang("wallpaper").set_type("main").set_icon("fa-image fa-solid")).click(function(){carrot.load_js_page("background","background","carrot.background.show()")}),$(this.menu.create("btn_add_bk").set_label("Add Background").set_type("add").set_icon("fa-image fa-solid")).click(function(){carrot.load_js_page("background","background","carrot.background.add()")}),$(this.menu.create("btn_bible").set_label("Bible").set_lang("bible").set_type("main").set_icon("fa-solid fa-book-medical")).click(function(){carrot.load_js_page("bible","bible","carrot.bible.list()")}),$(this.menu.create("btn_chat").set_label("Bible").set_lang("chat").set_type("main").set_icon("fa-solid fa-comments")).click(function(){carrot.load_js_page("chat","chat","carrot.chat.list()")}),$(this.menu.create("btn_ebook").set_label("Ebook").set_lang("ebook").set_type("main").set_icon("fa-solid fa-book")).click(function(){carrot.load_js_page("ebook","ebook","carrot.ebook.list()")}),$(this.menu.create("list_avatar").set_label("List Avatar").set_icon("fa-regular fa-image-portrait").set_type("dev")).click(function(){carrot.js("avatar","avatar","carrot.avatar.show()")}),$(this.menu.create("btn_list_share").set_label("List Share").set_type("dev").set_lang("share").set_icon("fa-solid fa-share-nodes")).click(function(){carrot.load_js_page("share","share","carrot.share.list()")}),$(this.menu.create("btn_list_fashion").set_label("List Fashion").set_type("dev").set_icon("fa-solid fa-shirt")).click(function(){carrot.load_js_page("fashion","fashion","carrot.fashion.show()")}),$(this.menu.create("btn_list_floor").set_label("List Floor").set_type("dev").set_icon("fa-solid fa-seedling")).click(function(){carrot.load_js_page("floor","floor","carrot.floor.show()")}),this.privacy_policy=new Carrot_Privacy_Policy,this.about_us=new Carrot_About_Us,this.player_media=new Carrot_Player_Media(this),this.file=new Carrot_File,this.pay=new Carrot_Pay(this),this.rate=new Carrot_Rate(this),this.tool=this.rate,this.data=new Carrot_data("carrotstore"+this.get_ver_cur("page"),this.get_ver_cur("page")),$(this.menu.create("btn_mode_host").set_label("Change Mode Host").set_type("setting").set_icon("fa-brands fa-dev")).click(function(){carrot.change_host_connection()}),"firestore"==carrot.type_server){var t=this.menu.create("btn_mode_host").set_label(this.firebaseConfig_mainhost.projectId).set_type("setting").set_icon("fa-solid fa-server");$(t).click(function(){carrot.show_list_change_server()})}else{var t=this.menu.create("btn_mode_host").set_label(carrot.os).set_type("setting").set_icon("fa-solid fa-server");$(t).click(function(){carrot.show_list_change_server()})}$(this.menu.create("data_version").set_label("Data Version").set_type("setting").set_icon("fa-regular fa-code-compare")).click(function(){carrot.show_edit_version_data_version()}),$(this.menu.create("btn_export_file_json").set_label("Export Collection").set_type("setting").set_icon("fa-solid fa-file-export")).click(function(){carrot.download_json()}),$(this.menu.create("btn_import_file_json").set_label("Import Collection (File)").set_type("setting").set_icon("fa-solid fa-file-import")).click(function(){carrot.show_import_json_file()}),$(this.menu.create("btn_site_map").set_label("Site Map").set_type("setting").set_icon("fa-solid fa-sitemap")).click(function(){carrot.show_site_map()}),$(this.menu.create("btn_update_config").set_label("Update File Config").set_type("setting").set_icon("fa-solid fa-file")).click(function(){carrot.act_update_file_config()}),$(this.menu.create("btn_del_all").set_label("Delete all data cache").set_type("setting").set_icon("fa-solid fa-trash-can")).click(function(){carrot.act_delete_all_data()}),$("#btn_model_site").click(function(){carrot.change_mode_site()}),!1==carrot.check_ver_cur("lang")&&carrot.langs.get_all_data_lang(),!1==carrot.check_ver_cur("lang_web")&&carrot.langs.get_data_lang_web(),this.user.show_info_user_login_in_header(),this.menu.show(),$(".btn-menu").click(function(){$(".btn-menu").removeClass("active"),$(".btn-menu i").removeClass("fa-bounce"),$(this).addClass("active"),$(this).find("i").addClass("fa-bounce")});var s=new Date().getMonth();s++,$("#logo_carrot").attr("src",this.url()+"/images/logo/logo_"+s+".png"),!1==carrot.check_ver_cur("lang")?(carrot.log("Get lang new version "+carrot.get_ver_cur("lang")),"firestore"==carrot.type_server?carrot.server.get_collection("lang",e=>{carrot.langs.list_lang=e,carrot.check_show_by_id_page()}):$.getJSON(carrot.config.list_url_data_lang[0],function(e){carrot.langs.list_lang=e,carrot.check_show_by_id_page()}),carrot.update_new_ver_cur("lang",!0)):carrot.check_show_by_id_page()}act_mode_dev(){this.count_act_dev++,this.count_act_dev>=3&&(this.is_dev=!0,localStorage.setItem("is_dev",this.is_dev),$("#btn_model_site").removeClass("d-none"),$("#btn_model_site").show(),this.count_act_dev=0,$.MessageBox("Active Model Dev!"))}change_mode_site(){"nomal"==this.mode_site?this.mode_site="dev":this.mode_site="nomal",localStorage.setItem("mode_site",this.mode_site),this.check_mode_site()}check_mode_site(){this.is_dev?($("#btn_model_site").removeClass("d-none").addClass("d-inline").show(),"nomal"==this.mode_site?($("#btn_model_site").removeClass("d-none").show().html('<i class="fa-solid fa-box"></i>'),$(".dev.btn-dev").each(function(){$(this).removeClass("d-none").removeClass("d-inline")}),$(".dev").each(function(){$(this).hide(100)})):($("#btn_model_site").removeClass("d-none").removeClass("d-inline").show().html('<i class="fa-brands fa-dev"></i>'),$(".dev.btn-dev").each(function(){$(this).removeClass("d-none").addClass("d-inline")}),$(".dev").each(function(){$(this).show(100)}))):($("#btn_model_site").removeClass("d-none").removeClass("d-inline").hide(),$(".dev").each(function(){$(this).hide(100)}),$(".dev.btn-dev").each(function(){$(this).removeClass("d-none").removeClass("d-inline")})),this.is_localhost?$("#btn_mode_host").html('<i class="fa-brands fa-dev fs-6 me-2"></i> Localhost'):$("#btn_mode_host").html('<i class="fa-sharp fa-solid fa-database fs-6 me-2"></i> Googlehost'),this.langs.load_data_lang_web()}convert_obj_to_list(e){var t=[];return $.each(e,function(e,s){t.push(JSON.parse(s))}),t}convert_obj_to_list_array(e){var t=[];return $.each(e,function(e,s){t.push(s)}),t}obj_to_array(e){return this.convert_obj_to_list(e)}random(e){return e.map(e=>({value:e,sort:Math.random()})).sort((e,t)=>e.sort-t.sort).map(({value:e})=>e)}show_edit_version_data_version(){var e=new Carrot_Form("frm_ver",this);e.set_title("Change Version Data"),e.set_db("setting_web","version"),e.on_db_doc(),e.set_act_done("carrot.done_update_data_version()"),e.set_msg_done("Update verion data success"),$.each(this.obj_version_new,function(t,s){e.create_field(t).set_label(t).set_val(s).set_type("number")});var t=e.create_btn();t.set_icon("fa-solid fa-arrows-up-to-line"),t.set_act("carrot.add_level_all_field_version()"),e.show()}add_level_all_field_version(){$(".cr_field").each(function(e,t){var s=$(t).val();s=(s=parseFloat(s)+.1).toFixed(2),$(t).val(s)})}done_update_data_version(){this.obj_version_new=null,this.obj_version_cur=null,this.save_obj_version_new(),this.save_obj_version_cur()}load_obj_version_new(){null!=localStorage.getItem("obj_version_new")?this.obj_version_new=JSON.parse(localStorage.getItem("obj_version_new")):this.obj_version_new={}}load_obj_version_cur(){null!=localStorage.getItem("obj_version_cur")?this.obj_version_cur=JSON.parse(localStorage.getItem("obj_version_cur")):this.obj_version_cur={}}save_obj_version_new(){localStorage.setItem("obj_version_new",JSON.stringify(this.obj_version_new))}save_obj_version_cur(){localStorage.setItem("obj_version_cur",JSON.stringify(this.obj_version_cur))}act_del_obj(e,t){this.db.collection(e).doc(t).delete().then(()=>{carrot.msg("Document "+t+" successfully deleted!"),$("#"+t).length&&$("#"+t).remove()}).catch(e=>{this.log_error(e)})}download_json(){var e=prompt("Enter collection json","Enter name collection");""!=e&&carrot.export(e)}export(e){this.loading("Processing export data ("+e+")");var t={};t.all_item=[],t.collection=e,this.db.collection(e).get().then(s=>{carrot.hide_loading(),s.forEach(e=>{var s=e.data();s.id_import=e.id,t.all_item.push(s)}),this.act_download_file_json(t,e)}).catch(e=>{this.log(e.message)})}act_download_file_json(e,t){var s=JSON.stringify(e,null,2),o=t+".json",a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s)),a.setAttribute("download",o),a.click()}check_ver_cur(e){return null!=this.obj_version_cur&&null!=this.obj_version_cur[e]&&this.obj_version_cur[e]==this.obj_version_new[e]}update_new_ver_cur(e,t=!1){null==this.obj_version_new&&(this.obj_version_new={}),null!=this.obj_version_new[e]?(null==this.obj_version_cur&&(this.obj_version_cur={}),this.obj_version_cur[e]=this.obj_version_new[e],t&&this.save_obj_version_cur()):(this.obj_version_cur[e]="0.0",this.obj_version_new[e]="0.0",t&&(this.save_obj_version_cur(),this.save_obj_version_new()))}delete_ver_cur(e){this.obj_version_cur[e]="0.0"}get_ver_cur(e){return null==this.obj_version_cur?"0.0":null!=this.obj_version_cur[e]?this.obj_version_cur[e]:"0.0"}change_title_page(e,t,s){document.title=e,this.id_page=s,""!=this.lang_url&&""!=t&&(t=this.get_url()+t+"&lang="+this.lang),""!=t?window.history.pushState(e,"Title",t):window.history.pushState(e,"",null)}change_title(e,t="",s=""){""==s&&(s="carrotstore"),""==t&&(t=carrot.url()),carrot.change_title_page(e,t,s)}check_event(){var carrot=this;$("#box_input_search").unbind("change"),$("#box_input_search").change(function(){var e=$("#box_input_search").val();carrot.act_search(e)}),$(".btn_app_export").click(function(){carrot.name_collection_cur=$(this).attr("db_collection"),carrot.name_document_cur=$(this).attr("db_document"),carrot.act_download_json_by_collection_and_doc()}),$(".btn_app_import").click(function(){var e=$(this).attr("db_collection"),t=$(this).attr("db_document"),s={};s.collection=e,s.document=t,carrot.show_import_json_box(s)}),$(".btn_app_edit").unbind("click"),$(".btn_app_edit").click(function(){var db_collection=$(this).attr("db_collection"),db_document=$(this).attr("db_document"),db_obj=$(this).attr("db_obj"),event_fun=$(this).attr("onclick");carrot.log("Edit "+db_collection+" : "+db_document),carrot.tool.alive(event_fun)?carrot.get_doc(db_collection,db_document,eval(event_fun)):carrot.get_doc(db_collection,db_document,eval("carrot."+db_obj+".edit"))}),$(".btn_app_del").unbind("click"),$(".btn_app_del").click(function(){var db_collection=$(this).attr("db_collection"),db_document=$(this).attr("db_document"),event_fun=$(this).attr("onclick");Swal.fire({title:"Are you sure?",text:"You won't be able to revert this "+db_collection+"."+db_document+" ?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(result=>{result.isConfirmed&&(carrot.tool.alive(event_fun)?eval(event_fun):carrot.act_del_obj(db_collection,db_document))})}),$("#btn_share").click(function(){carrot.show_share()}),$("#register_protocol_url").click(function(){carrot.register_protocol_url()}),this.rate.check_event(),this.check_mode_site(),$("#qr_cdoe").qrcode({render:"canvas",minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#428400",background:null,text:window.location.href,radius:5,quiet:0,mode:0,mSize:.1,mPosX:.5,mPosY:.5,label:"no label",fontname:"sans",fontcolor:"#000",image:null}),$("#qr_cdoe").attr("id","qr_cdoe_done_success"),$('[data-toggle="tooltip"]').tooltip()}act_search(e){$(".box_app").each(function(t,s){var o=$(s).attr("id"),a=$(s).attr("key_search");-1!=o.search(e)||-1!=a.search(e)?$(s).show():$(s).hide()})}uniq=function(){return new Date().getTime()};create_id(){return this.uniq()}l(e,t=""){return null!=this.langs?this.langs.get_val_lang(e,t):t}l_html(e,t=""){var s="";return s=null!=this.langs?this.langs.get_val_lang(e,t):t,'<l class="lang" key_lang="'+e+'">'+s+"</l>"}download_json_doc(){this.name_collection_cur=prompt("Enter collection","Enter name collection"),""!=this.name_collection_cur&&(this.name_document_cur=prompt("Enter document","Enter document in collection"),""!=this.name_document_cur&&this.act_download_json_by_collection_and_doc())}act_download_json_by_collection_and_doc(){this.get_doc(this.name_collection_cur,this.name_document_cur,this.done_get_file_json)}done_get_file_json(e,t){e.collection=t.name_collection_cur;var s=t.name_collection_cur+"-"+t.name_document_cur+".json";t.act_download_file_json(e,s)}show_import_json_box(e){var t=this;null==e&&((e={}).collection="",e.document=""),$.MessageBox({input:{db_collection:{label:"Collection",defaultValue:e.collection},db_document:{label:"Document ID",defaultValue:e.document},data:{type:"textarea",label:"Nhập kiểu dữ liệu văn bảng dạng json:"}},message:"Import JSON document text"}).done(function(e,s){if(""==e.data)return $.MessageBox("Dữ liệu json trống kh\xf4ng thể import!"),!1;var o=e.db_collection,a=e.db_document,i=JSON.parse(e.data);delete e.db_collection,delete e.db_document,delete e.data,t.set_doc(o,a,i),"app"==o&&t.app.delete_obj_app(),$.MessageBox("Import Data Json Success!!!")})}show_share(){let e={title:"Carrot Store",text:"Get Now",url:window.location.href};navigator.share(e)}register_protocol_url(){window.navigator&&window.navigator.registerProtocolHandler?navigator.registerProtocolHandler("web+app",`${window.location.origin}/?page=app&id=%s`,"Carrot App"):$.MessageBox("Your browser does not support the Stellar-protocol: SEP-0007. Use Chrome, Opera or Firefox to open web+stellar links")}show_import_json_file(){var e=this,t="";t='<div class="section-container p-2 p-xl-4">',t+='<div class="row">',t+='<div class="col-6">',t+="<form>",t+='<div class="form-row">',t+="<h2>Import Data</h2>",t+="</div>",t+='<div class="form-row">',t+='<div class="custom-file">',t+='<label for="input-file-import"><i class="fa-solid fa-database"></i> File data json</label>',t+='<input type="file" class="custom-file-input form-control"" id="input-file-import">',t+='<small id="emailHelp" class="form-text text-muted">Upload <b>json</b> data file to update data into the system</small>',t+="</div>",t+="</div>",t+="</form>",t+="</div>",t+='<div class="col-6">',t+="<form>",t+='<div class="form-row">',t+="<h2>Export Data</h2>",t+="</div>",t+='<div class="form-row">',t+='<div class="custom-file">',t+='<label for="input-file-import"><i class="fa-solid fa-file-arrow-down"></i> Download file json database </label>',t+='<br/><div class="btn btn-success mr-1" role="button" onclick="carrot.download_json();return false;"><i class="fa-solid fa-download"></i> Download Collection</div> ',t+='<div class="btn btn-success" role="button" onclick="carrot.download_json_doc();return false;"><i class="fa-solid fa-file-arrow-down"></i> Download Doc</div>',t+="<br/>",t+='<small id="emailHelp" class="form-text text-muted">Download <b>json</b> data file to backup data into the system</small>',t+="</div>",t+="</div>",t+="</form>",t+="</div>",t+="</div>",t+='<div class="row"><pre><code class="language-json col-12" id="file_contain"></code></pre></div>',t+="</div>",this.show(t),$("#input-file-import").on("change",function(){var t=$(this).get(0).files,s=new FileReader;s.readAsText(t[0]),Swal.showLoading(),s.addEventListener("load",function(t){var s=JSON.parse(t.target.result);if(null==s.collection)return e.msg("Collection not found in File json","error"),!1;var o=s.collection;if(null==s.all_item)delete s.collection,e.db.collection(o).doc(s.id).set(s),e.msg("Import Document Data Success!");else{var a=s.all_item;$.each(a,function(t,s){var a="";null!=s.id_import?(a=s.id_import,delete s.id_import):a="id"+e.create_id(),e.db.collection(o).doc(a).set(s)}),e.msg("Import Collection Data Success!")}var i=JSON.stringify(s,null,"	");$("#file_contain").html(i),hljs.highlightAll()})})}log(e,t="info"){console.log(e),"alert"==t&&(t="warning"),"dev"==this.mode_site&&SnackBar({message:e,timeout:5e3,status:t,position:"tr"})}log_error(e){if("dev"==this.mode_site){console.log(e);var t="";t+="<p>"+e.toString()+"</p>",null!=e.stack&&(t+='<p class="fs-9">'+e.stack+"</p>"),Swal.fire({title:e.name,icon:"error",html:t,showCloseButton:!0,focusConfirm:!0})}}get_url(){var e="";return""!=location.port&&(e=":"+location.port),location.protocol+"//"+location.hostname+e+location.pathname}change_host_connection(){this.is_localhost?(this.is_localhost=!1,localStorage.setItem("is_localhost","false")):(this.is_localhost=!0,localStorage.setItem("is_localhost","true")),this.check_mode_site(),this.setup_sever_db(),this.msg("Thay đổi chế độ kết nối cơ sở dữ liệu th\xe0nh c\xf4ng! Load lại trang để l\xe0m mới c\xe1c chức năng!")}check_show_by_id_page(){if(carrot.load_bar(),$("#head").show(),$("#head_nav").show(),this.id_page=cr.arg("p"),this.id_page){var obj_page_show;this.log("check_show_by_id_page : "+this.id_page,"info"),null!=carrot[this.id_page]?(eval("carrot."+this.id_page+".show()"),$("#load_bar").css("width","100%")):"app"==this.id_page?this.load_js_page("app","appp","carrot.appp.show()"):this.load_js_page(this.id_page,this.id_page,"carrot."+id_page+".show()")}else{var id_page=cr.arg("page");id_page?this.load_js_page(id_page,id_page,"carrot."+id_page+".show()"):(this.load_bar(),$("#load_bar").css("width","100%"),this.load_js_page("home","home","carrot.home.show()"))}}show(e){this.body.html(e),window.scrollTo(0,0),$("#head").show(),$("#head_nav").show()}btn_dev(e,t,s=null,o=null,a=null,i=""){var n="";return null==s&&(s=e),n+="<div class='row dev d-flex mt-2'>",n+="<div class='dev col-6 d-flex btn-group'>",null!=o?n+="<div role='button' class='dev btn btn_app_edit btn-warning btn-sm mr-2' onclick='"+o+"'  db_collection='"+e+"' db_document='"+t+"' db_obj='"+s+'\'><i class="fa-solid fa-pen-to-square"></i></div> ':n+="<div role='button' class='dev btn btn_app_edit btn-warning btn-sm mr-2' db_collection='"+e+"' db_document='"+t+"' db_obj='"+s+'\'><i class="fa-solid fa-pen-to-square"></i></div> ',null!=a?n+="<div role='button' class='dev btn btn_app_del btn-danger btn-sm mr-2' onclick='"+a+'\'><i class="fa-solid fa-trash"></i></div> ':n+="<div role='button' class='dev btn btn_app_del btn-danger btn-sm mr-2' db_collection='"+e+"' db_document='"+t+"' db_obj='"+s+'\'><i class="fa-solid fa-trash"></i></div> ',n+=i,n+="<div role='button' class='dev btn btn_app_export btn-dark btn-sm mr-2'  db_collection='"+e+"' db_document='"+t+"' db_obj='"+s+'\'><i class="fa-solid fa-download"></i></div> ',n+="<div role='button' class='dev btn btn_app_import btn-info btn-sm mr-2'  db_collection='"+e+"' db_document='"+t+"' db_obj='"+s+'\'><i class="fa-solid fa-upload"></i></div>',n+="</div>",n+="</div>"}box(e){$("#box_body").html(e),$("#box").modal("show")}show_lis_by_collection(e){this.get_list_doc(e,this.act_done_show_collection)}act_done_show_collection(e,t){var s="";s+='<div class="row m-0">',$(t.convert_obj_to_list(e)).each(function(e,o){var a=new Carrot_List_Item(t);a.set_id(o.id),a.set_name(o.key),a.set_tip(o.msg),a.set_db_collection("app"),s+=a.html()}),s+="</div>",t.show(s),t.check_event()}msg(e,t="success",s=6500){"alert"==t&&(t="warning"),Swal.fire({icon:t,title:e,showCloseButton:!0,focusConfirm:!1})}show_pay(e,t,s,o,a){var i=this;Swal.fire({title:t,html:'<div id="paypal-button-container"></div>',showCloseButton:!0,focusConfirm:!1}),paypal.Buttons({createOrder:function(a,i){return i.order.create({purchase_units:[{amount:{currency_code:"USD",value:o,breakdown:{item_total:{value:o,currency_code:"USD"}}},items:[{name:t,quantity:"1",description:s,sku:e,category:"DIGITAL_GOODS",unit_amount:{currency_code:"USD",value:o}}]}]})},onApprove:function(t,s){return s.order.capture().then(function(t){null!=i.in_app_pay&&$.each(i.in_app_pay,function(e,s){t[e]=s}),i.set_doc("order",e+"_"+i.create_id(),t),a(i),i.msg("Pay success!")})}}).render("#paypal-button-container")}load_bar(){if($("#load_bar").length>0){this.load_bar_count_data+=2;var e=10*this.load_bar_count_data;$("#load_bar").css("width",e+"%")}}home_page(){null!=carrot.home?carrot.home.show():carrot.load_js_page("home","home","carrot.home.show()")}html_404(e=null){var t="";return t+='<div class="d-flex align-items-center justify-content-center vh-100">',t+='<div class="text-center row">',t+='<div class=" col-md-6">',t+='<img src="images/404.png" alt="404" class="img-fluid">',t+="</div>",t+='<div class=" col-md-6 mt-5">',t+='<p class="fs-3"> <span class="text-danger">Opps!</span> Page not found.</p>',t+='<p class="lead">',t+="The page you’re looking for doesn’t exist.",t+="</p>",t+='<a role="button" class="btn btn-success" onClick="carrot.home_page();return false;"><i class="fa-solid fa-house"></i> Go Home</a>',null!=e&&$(e).each(function(e,s){t+=s.html()}),t+="</div>",t+="</div>",t+="</div>"}show_404(e=null){var t=this.html_404(e);this.show(t),this.check_event()}show_site_map(){var e="",t="";this.show('<textarea id="data_xml_site_map" name="data_xml_site_map" class="language-xml hljs" rows="4" cols="50" style="width:100%;height:100%"></textarea>');var s=new Date().toISOString().slice(0,10),o=new Carrot_Query("app");o.add_select("name_en"),carrot.loading(),o.get_data(o=>{$(o).each(function(t,o){carrot.hide_loading(),e+="<url>",e+="<loc>https://carrotstore.web.app/?page=app&amp;id="+encodeURIComponent(o.id_doc)+"</loc>",e+="<lastmod>"+s+"</lastmod>",e+="<changefreq>daily</changefreq>",e+="<priority>1</priority>",e+="</url>"});var a=new Carrot_Query("song");a.add_select("name"),a.get_data(o=>{$(o).each(function(e,o){t+="<url>",t+="<loc>https://carrotstore.web.app/?page=song&amp;id="+encodeURIComponent(o.id_doc)+"</loc>",t+="<lastmod>"+s+"</lastmod>",t+="<changefreq>daily</changefreq>",t+="<priority>0.9</priority>",t+="</url>"});var a='<?xml version="1.0" encoding="UTF-8"?>\n';a+='<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9">\n',a+=e+"\n"+t+"\n",a+="</urlset>",carrot.hide_loading(),$("#data_xml_site_map").val(a),hljs.highlightAll()})})}show_loading_search(){$("#search_status_icon").attr("class","fa-solid fa-spinner fa-spin-pulse")}hide_loading_search(){$("#search_status_icon").attr("class","fa-sharp fa-solid fa-magnifying-glass"),$("#box_input_search").val("")}loading_html(){return'<div class="col-12 text-center"><i class="fa-solid fa-ghost fa-bounce"></i> <i class="fa-solid fa-ghost fa-beat-fade" style="color: green;"></i> <i class="fa-solid fa-ghost fa-bounce"></i> <i class="fa-solid fa-ghost fa-beat-fade" style="color: green;"></i> <i class="fa-solid fa-ghost fa-flip" style="color: #63E6BE;"></i></div>'}loading(e=""){""!=e&&(e+="<br/><br/>"),Swal.fire({title:"Please wait...",html:e+carrot.loading_html(),didOpen(){Swal.showLoading()}})}hide_loading(){Swal.close()}change_style_mode(){$("#btn_model_style_icon").removeClass("fa-moon"),$("#btn_model_style_icon").removeClass("fa-sun"),"sun"==this.style_mode?(this.style_mode="moon",$("#btn_model_style_icon").addClass("fa-sun"),$("#style_obj").attr("href","assets/css/style2.css?ver="+this.get_ver_cur("js"))):(this.style_mode="sun",$("#btn_model_style_icon").addClass("fa-moon"),$("#style_obj").attr("href","assets/css/style.css?ver="+this.get_ver_cur("js")))}show_list_change_server(){var e=new Carrot_Form("frm_list_server",this);e.set_title("Change Server Database"),e.off_btn_done(),e.set_msg_done("Update verion data success");var t=e.create_field("server_db");t.set_label("Select Server"),t.set_type("select");var s=0;$(this.config.server).each(function(e,o){t.add_option(e,o.projectId),o.projectId==carrot.firebaseConfig_mainhost.projectId&&(s=e)}),t.set_val(s),e.create_btn().set_act("carrot.act_done_change_server()").set_label("Done"),e.show()}act_done_change_server(){this.index_server=parseInt($("#server_db").val()),localStorage.setItem("index_server",this.index_server),location.reload()}act_update_file_config(){fetch("config.json?v="+carrot.v).then(e=>e.text()).then(e=>{let t=btoa(e),s=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(s),a=document.createElement("a");a.href=o,a.download="rabbit.data",a.click(),URL.revokeObjectURL(o),this.msg("Update File config success!","success")})}act_next_server_when_fail(){this.index_server++,this.index_server>=this.config.server.length&&(this.index_server=0),localStorage.setItem("index_server",this.index_server),setTimeout(500,()=>{location.reload()})}act_delete_all_data(){localStorage.clear(),localStorage.setItem("index_server",this.index_server),location.reload()}js(e,t=null,s=null){carrot.load_js_page(e,t,s)}load_js_page(file_name_js_page,obj_js=null,callback=null){carrot.id_page=file_name_js_page;var url="assets/js/pages/"+file_name_js_page+".js?ver="+this.get_ver_cur("js");if(null!=obj_js&&null!=carrot[obj_js]){eval(callback);return}return new Promise((resolve,reject)=>{let script=document.createElement("script");script.src=url,script.onload=()=>{null!=callback&&eval(callback)},script.onerror=reject,document.head.appendChild(script)}).then(()=>{"function"==typeof callback&&null!=callback&&eval(callback)}).catch(e=>{carrot.home_page()})}url(){var e=window.location.origin;return"https://kurotsmile.github.io"==e?e+"/Carrot":window.location.origin}}